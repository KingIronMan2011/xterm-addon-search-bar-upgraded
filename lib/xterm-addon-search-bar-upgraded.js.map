{"version":3,"file":"xterm-addon-search-bar-upgraded.js","sources":["../node_modules/style-inject/dist/style-inject.es.js","../src/index.ts"],"sourcesContent":["function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import { ITerminalAddon, Terminal } from 'xterm';\nimport { ISearchOptions, SearchAddon } from 'xterm-addon-search';\nimport './index.css';\n\nexport interface SearchBarOption extends ISearchOptions {\n  searchAddon: SearchAddon;\n}\n\nconst ADDON_MARKER_NAME = 'xterm-search-bar__addon';\n\nexport class SearchBarAddon implements ITerminalAddon {\n  private readonly options: Partial<SearchBarOption>;\n  private terminal: Terminal;\n  private readonly searchAddon: SearchAddon;\n  private searchBarElement: HTMLDivElement;\n  private searchKey: string;\n\n  constructor(options: Partial<SearchBarOption>) {\n    this.options = options || {};\n    if (this.options && this.options.searchAddon) {\n      this.searchAddon = this.options.searchAddon;\n    }\n  }\n\n  activate(terminal: Terminal): void {\n    this.terminal = terminal;\n    if (!this.searchAddon) {\n      console.error('Cannot use search bar addon until search addon has been loaded!');\n    }\n  }\n\n  dispose() {\n    this.hidden();\n  }\n\n  /**\n   *  Show the bar in the term\n   * @returns empty\n   * @memberof SearchBarAddon  necessary search addon instance\n   */\n  show() {\n    if (!this.terminal || !this.terminal.element) {\n      return;\n    }\n    if (this.searchBarElement) {\n      this.searchBarElement.style.visibility = 'visible';\n      (this.searchBarElement.querySelector('input') as HTMLInputElement).select();\n      return;\n    }\n\n    this.terminal.element.style.position = 'relative';\n    const element = document.createElement('div');\n    element.innerHTML = `\n       <input type=\"text\" class=\"search-bar__input\" name=\"search-bar__input\"/>\n       <button class=\"search-bar__btn prev\"></button>\n       <button class=\"search-bar__btn next\"></button>\n       <button class=\"search-bar__btn close\"></button>\n    `;\n    element.className = ADDON_MARKER_NAME;\n    const parentElement = <HTMLElement>this.terminal.element.parentElement;\n    this.searchBarElement = element;\n    if (!['relative', 'absoulte', 'fixed'].includes(parentElement.style.position)) {\n      parentElement.style.position = 'relative';\n    }\n    parentElement.appendChild(this.searchBarElement);\n    this.on('.search-bar__btn.close', 'click', () => {\n      this.hidden();\n    });\n    this.on('.search-bar__btn.next', 'click', () => {\n      this.searchAddon.findNext(this.searchKey, {\n        incremental: false,\n      });\n    });\n    this.on('.search-bar__btn.prev', 'click', () => {\n      this.searchAddon.findPrevious(this.searchKey, {\n        incremental: false,\n      });\n    });\n    this.on('.search-bar__input', 'keyup', (e: any) => {\n      this.searchKey = (e.target as HTMLInputElement).value;\n      this.searchAddon.findNext(this.searchKey, {\n        incremental: e.key !== `Enter`,\n      });\n    });\n    (this.searchBarElement.querySelector('input') as HTMLInputElement).select();\n  }\n\n  /**\n   * You can manually call close, also can click the close button on the bar\n   * @memberof SearchBarAddon\n   */\n  hidden() {\n    if (this.searchBarElement && (this.terminal.element as HTMLElement).parentElement) {\n      this.searchBarElement.style.visibility = 'hidden';\n    }\n  }\n\n  private on(selector: string, event: string, cb: (e: any) => void) {\n    const parentElement = <HTMLElement>(this.terminal.element as HTMLElement).parentElement;\n    parentElement.addEventListener(event, (e) => {\n      let target = e.target;\n\n      while (target !== document.querySelector(selector)) {\n        if (target === parentElement) {\n          target = null;\n          break;\n        }\n\n        target = (target as HTMLElement).parentElement;\n      }\n\n      if (target === document.querySelector(selector)) {\n        cb.call(this, e);\n        e.stopPropagation();\n      }\n    });\n  }\n\n  /**\n   * You can customize your own style, and then add CSS string template after search bar init\n   * @param {string} newStyle\n   * @memberof SearchBarAddon\n   */\n  addNewStyle(newStyle: string) {\n    let styleElement = document.getElementById(ADDON_MARKER_NAME) as HTMLStyleElement;\n\n    if (!styleElement) {\n      styleElement = document.createElement('style');\n      styleElement.type = 'text/css';\n      styleElement.id = ADDON_MARKER_NAME;\n      document.getElementsByTagName('head')[0].appendChild(styleElement);\n    }\n\n    styleElement.appendChild(document.createTextNode(newStyle));\n  }\n}\n"],"names":[],"mappings":"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","x_google_ignoreList":[0]}